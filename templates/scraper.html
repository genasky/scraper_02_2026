<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä - Search Engines Scraper</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .nav-breadcrumb {
            background: #f8fafc;
            padding: 1rem 20px;
            margin-bottom: 2rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .nav-breadcrumb a {
            color: #4f46e5;
            text-decoration: none;
        }
        
        .nav-breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .nav-breadcrumb span {
            color: #6b7280;
            margin: 0 0.5rem;
        }
        
        .query-input-wrapper {
            display: flex;
            gap: 0.5rem;
            align-items: stretch;
        }
        
        .query-input-wrapper input {
            flex: 1;
        }
        
        .btn-ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .btn-ai:hover {
            opacity: 0.9;
        }
        
        .btn-ai:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .btn-ai-loading {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .ai-variants-container {
            display: none;
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .ai-variants-container.visible {
            display: block;
        }
        
        .ai-variants-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .ai-variants-header h4 {
            margin: 0;
            color: #1f2937;
        }
        
        .ai-variants-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .ai-variant-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .ai-variant-item:hover {
            background: #f3f4f6;
            border-color: #667eea;
        }
        
        .ai-variant-item input[type="radio"] {
            margin: 0;
        }
        
        .ai-variant-item label {
            flex: 1;
            margin: 0;
            cursor: pointer;
        }
        
        .ai-variant-item .variant-type {
            font-size: 0.7rem;
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            text-transform: uppercase;
        }
        
        .variant-type-alt {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .variant-type-exp {
            background: #d1fae5;
            color: #059669;
        }
        
        .ai-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .btn-search-all {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-search-all:hover {
            background: #059669;
        }
        
        .btn-use-variant {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-use-variant:hover {
            background: #4338ca;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-search-plus"></i> –ü–æ–∏—Å–∫–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä</h1>
                <p>–ü–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–∏—Å–∫–æ–≤—ã–º —Å–∏—Å—Ç–µ–º–∞–º</p>
            </div>
        </header>

        <nav class="nav-breadcrumb">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <span>/</span>
            <span>–ü–æ–∏—Å–∫–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä</span>
        </nav>

        <main class="main-content">
            <section class="search-section">
                <div class="search-card">
                    <h2><i class="fas fa-search"></i> –ü–æ–∏—Å–∫</h2>
                    
                    <form id="searchForm" class="search-form">
                        <div class="form-group">
                            <label for="query">–ó–∞–ø—Ä–æ—Å:</label>
                            <div class="query-input-wrapper">
                                <input type="text" id="query" name="query" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å..." required>
                                <button type="button" class="btn-ai" id="btnAI" onclick="expandWithAI()" title="–†–∞—Å—à–∏—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å –ø–æ–º–æ—â—å—é AI">
                                    <i class="fas fa-robot"></i> AI
                                </button>
                            </div>
                        </div>
                        
                        <div class="ai-variants-container" id="aiVariantsContainer">
                            <div class="ai-variants-header">
                                <h4><i class="fas fa-lightbulb"></i> –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç AI</h4>
                                <button type="button" onclick="closeAIVariants()" style="background:none;border:none;cursor:pointer;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="ai-variants-list" id="aiVariantsList"></div>
                            <div class="ai-actions">
                                <button type="button" class="btn-search-all" onclick="searchAllVariants()">
                                    <i class="fas fa-play"></i> –ü–æ –≤—Å–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
                                </button>
                                <button type="button" class="btn-use-variant" onclick="useSelectedVariant()">
                                    <i class="fas fa-search"></i> –í—ã–±—Ä–∞–Ω–Ω—ã–π
                                </button>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>–ü–æ–∏—Å–∫–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã:</label>
                                <div class="engine-controls">
                                    <div class="select-all-controls">
                                        <input type="checkbox" id="select_all" onchange="toggleAllEngines(this)">
                                        <label for="select_all">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</label>
                                    </div>
                                    <div class="engine-checkboxes">
                                        {% for engine_name in engines.keys() %}
                                        <div class="checkbox-wrapper">
                                            <input type="checkbox" id="engine_{{ engine_name }}" name="engines" value="{{ engine_name }}" {% if loop.first %}checked{% endif %}>
                                            <label for="engine_{{ engine_name }}">{{ engine_name|title }}</label>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="pages">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</label>
                                <select id="pages" name="pages">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="filter">–§–∏–ª—å—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</label>
                                <select id="filter" name="filter">
                                    <option value="">–ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞</option>
                                    <option value="title">–ü–æ –∑–∞–≥–æ–ª–æ–≤–∫—É</option>
                                    <option value="url">–ü–æ URL</option>
                                    <option value="text">–ü–æ —Ç–µ–∫—Å—Ç—É</option>
                                    <option value="host">–ü–æ —Ö–æ—Å—Ç—É</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-wrapper" style="margin-top: 2rem;">
                                    <input type="checkbox" id="ignore_duplicates" name="ignore_duplicates">
                                    <label for="ignore_duplicates">–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã</label>
                                </div>
                            </div>
                        </div>

                        <div class="advanced-settings">
                            <button type="button" class="advanced-toggle" onclick="toggleAdvancedSettings()">
                                <i class="fas fa-cog"></i> –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                            
                            <div class="advanced-content" id="advancedContent" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="language">–Ø–∑—ã–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</label>
                                        <select id="language" name="language">
                                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                            <option value="en">English</option>
                                            <option value="de">Deutsch</option>
                                            <option value="fr">Fran√ßais</option>
                                            <option value="es">Espa√±ol</option>
                                            <option value="zh">‰∏≠Êñá</option>
                                            <option value="ja">Êó•Êú¨Ë™û</option>
                                            <option value="auto">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="country">–°—Ç—Ä–∞–Ω–∞/–†–µ–≥–∏–æ–Ω:</label>
                                        <select id="country" name="country">
                                            <option value="">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</option>
                                            <option value="ru">–†–æ—Å—Å–∏—è</option>
                                            <option value="us">–°–®–ê</option>
                                            <option value="gb">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</option>
                                            <option value="de">–ì–µ—Ä–º–∞–Ω–∏—è</option>
                                            <option value="fr">–§—Ä–∞–Ω—Ü–∏—è</option>
                                            <option value="es">–ò—Å–ø–∞–Ω–∏—è</option>
                                            <option value="it">–ò—Ç–∞–ª–∏—è</option>
                                            <option value="ua">–£–∫—Ä–∞–∏–Ω–∞</option>
                                            <option value="by">–ë–µ–ª–∞—Ä—É—Å—å</option>
                                            <option value="kz">–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="safe_search">–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–∏—Å–∫:</label>
                                        <select id="safe_search" name="safe_search">
                                            <option value="off">–í—ã–∫–ª</option>
                                            <option value="moderate" selected>–£–º–µ—Ä–µ–Ω–Ω—ã–π</option>
                                            <option value="strict">–°—Ç—Ä–æ–≥–∏–π</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="result_type">–¢–∏–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</label>
                                        <select id="result_type" name="result_type">
                                            <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                                            <option value="news">–ù–æ–≤–æ—Å—Ç–∏</option>
                                            <option value="images">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</option>
                                            <option value="videos">–í–∏–¥–µ–æ</option>
                                            <option value="shopping">–ü–æ–∫—É–ø–∫–∏</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" id="use_tor" name="use_tor">
                                        <label for="use_tor">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Tor</label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <h4><i class="fas fa-network-wired"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏</h4>
                                    <div class="proxy-settings">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="proxy_type">–¢–∏–ø –ø—Ä–æ–∫—Å–∏:</label>
                                                <select id="proxy_type" name="proxy_type" onchange="updateProxyPlaceholder()">
                                                    <option value="">–ë–µ–∑ –ø—Ä–æ–∫—Å–∏</option>
                                                    <option value="http">HTTP</option>
                                                    <option value="https">HTTPS</option>
                                                    <option value="socks4">SOCKS4</option>
                                                    <option value="socks5">SOCKS5</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="proxy_host">–•–æ—Å—Ç:</label>
                                                <input type="text" id="proxy_host" name="proxy_host" placeholder="127.0.0.1">
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="proxy_port">–ü–æ—Ä—Ç:</label>
                                                <input type="number" id="proxy_port" name="proxy_port" placeholder="8080" min="1" max="65535">
                                            </div>
                                            <div class="form-group">
                                                <label for="proxy_username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                                                <input type="text" id="proxy_username" name="proxy_username" placeholder="">
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="proxy_password">–ü–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                                                <input type="password" id="proxy_password" name="proxy_password" placeholder="">
                                            </div>
                                            <div class="form-group">
                                                <div class="checkbox-wrapper">
                                                    <input type="checkbox" id="proxy_verify_ssl" name="proxy_verify_ssl" checked>
                                                    <label for="proxy_verify_ssl">–ü—Ä–æ–≤–µ—Ä—è—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="search-btn">
                            <i class="fas fa-search"></i> –ù–∞–π—Ç–∏
                        </button>
                    </form>
                </div>
            </section>

            <section class="results-section" id="resultsSection" style="display: none;">
                <div class="results-header">
                    <h2><i class="fas fa-list"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                    <div class="results-actions">
                        <span class="results-count"></span>
                        <div class="export-buttons">
                            <button class="export-btn" onclick="exportResults('json')">
                                <i class="fas fa-download"></i> JSON
                            </button>
                            <button class="export-btn" onclick="exportResults('csv')">
                                <i class="fas fa-download"></i> CSV
                            </button>
                        </div>
                    </div>
                </div>

                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...</p>
                </div>

                <div class="results-container" id="resultsContainer"></div>
            </section>
        </main>

        <footer class="footer">
            <p>&copy; 2024 Search Engines Scraper. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥–≤–∏–∂–∫–∏: {% for engine in engines.keys() %}{{ engine|title }}{% if not loop.last %}, {% endif %}{% endfor %}</p>
        </footer>
    </div>

    <div class="toast" id="toast"></div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        let aiVariants = [];
        let originalQuery = '';
        
        const AI_SETTINGS_KEY = 'aiSearchSettings';
        
        function getAISettings() {
            const saved = localStorage.getItem(AI_SETTINGS_KEY);
            if (saved) {
                return JSON.parse(saved);
            }
            return { enabled: false, ollamaUrl: 'http://localhost:11434', model: 'llama3', mode: 'both' };
        }
        
        async function expandWithAI() {
            const queryInput = document.getElementById('query');
            const query = queryInput.value.trim();
            
            if (!query) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è', 'error');
                return;
            }
            
            const settings = getAISettings();
            
            if (!settings.enabled) {
                showToast('AI-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ. –í–∫–ª—é—á–∏—Ç–µ –µ–≥–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.', 'error');
                return;
            }
            
            const btnAI = document.getElementById('btnAI');
            btnAI.disabled = true;
            btnAI.innerHTML = '<i class="fas fa-spinner fa-spin"></i> AI...';
            btnAI.classList.add('btn-ai-loading');
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
                const statusResponse = await fetch('/api/ai-status');
                const statusData = await statusResponse.json();
                
                // –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤–∫–ª—é—á–µ–Ω
                if (!statusData.connected && settings.autoStart) {
                    showToast('üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º Ollama...', 'info');
                }
                
                const response = await fetch('/api/ai-expand', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        mode: settings.mode,
                        model: settings.model,
                        ollama_url: settings.ollamaUrl,
                        auto_start: settings.autoStart,
                        auto_stop: settings.autoStop
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    aiVariants = data.variants || [];
                    originalQuery = query;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –Ω–∞—á–∞–ª–æ
                    const allQueries = [query, ...aiVariants];
                    
                    displayAIVariants(allQueries);
                    
                    let msg = '–ü–æ–ª—É—á–µ–Ω–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: ' + aiVariants.length;
                    if (data.ollama_auto_started) {
                        msg += ' (Ollama –∑–∞–ø—É—â–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)';
                    }
                    showToast(msg, 'success');
                } else {
                    showToast(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞', 'error');
                }
            } catch (e) {
                showToast('–û—à–∏–±–∫–∞: ' + e.message, 'error');
            }
            
            btnAI.disabled = false;
            btnAI.innerHTML = '<i class="fas fa-robot"></i> AI';
            btnAI.classList.remove('btn-ai-loading');
        }
        
        function displayAIVariants(variants) {
            const container = document.getElementById('aiVariantsContainer');
            const list = document.getElementById('aiVariantsList');
            
            list.innerHTML = '';
            
            variants.forEach((variant, index) => {
                const isOriginal = index === 0;
                const type = isOriginal ? 'original' : (index <= 3 ? 'alt' : 'exp');
                const typeLabel = isOriginal ? '–û—Ä–∏–≥–∏–Ω–∞–ª' : (type === 'alt' ? 'ALT' : 'EXP');
                const typeClass = isOriginal ? '' : (type === 'alt' ? 'variant-type-alt' : 'variant-type-exp');
                
                const item = document.createElement('div');
                item.className = 'ai-variant-item';
                item.innerHTML = `
                    <input type="radio" name="aiVariant" id="variant_${index}" value="${index}" ${index === 0 ? 'checked' : ''}>
                    <label for="variant_${index}">${variant}</label>
                    <span class="variant-type ${typeClass}">${typeLabel}</span>
                `;
                list.appendChild(item);
            });
            
            container.classList.add('visible');
        }
        
        function closeAIVariants() {
            const container = document.getElementById('aiVariantsContainer');
            container.classList.remove('visible');
        }
        
        function useSelectedVariant() {
            const selected = document.querySelector('input[name="aiVariant"]:checked');
            if (selected) {
                const index = parseInt(selected.value);
                const query = index === 0 ? originalQuery : aiVariants[index - 1];
                document.getElementById('query').value = query;
                closeAIVariants();
                showToast('–í—ã–±—Ä–∞–Ω –∑–∞–ø—Ä–æ—Å: ' + query, 'success');
            }
        }
        
        async function searchAllVariants() {
            if (aiVariants.length === 0 && !originalQuery) {
                showToast('–ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞', 'error');
                return;
            }
            
            const settings = getAISettings();
            const allQueries = [originalQuery, ...aiVariants];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const btnSearchAll = document.querySelector('.btn-search-all');
            btnSearchAll.disabled = true;
            btnSearchAll.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü–æ–∏—Å–∫...';
            
            showToast('–ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫ –ø–æ ' + allQueries.length + ' –∑–∞–ø—Ä–æ—Å–∞–º...', 'info');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å
            const currentQuery = document.getElementById('query').value;
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ –ø–æ –∫–∞–∂–¥–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É
            const allResults = [];
            
            for (let i = 0; i < allQueries.length; i++) {
                const q = allQueries[i];
                showToast(`–ü–æ–∏—Å–∫: ${i + 1}/${allQueries.length} - ${q}`, 'info');
                
                try {
                    const response = await fetch('/search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            query: q,
                            engines: getSelectedEngines(),
                            pages: parseInt(document.getElementById('pages').value) || 1,
                            ignore_duplicates: document.getElementById('ignore_duplicates').checked,
                            filter: document.getElementById('filter').value
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success && data.results) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –∫ –∫–∞–∂–¥–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                        data.results.forEach(r => {
                            r.search_query = q;
                            allResults.push(r);
                        });
                    }
                } catch (e) {
                    console.error('Search error for query:', q, e);
                }
            }
            
            btnSearchAll.disabled = false;
            btnSearchAll.innerHTML = '<i class="fas fa-play"></i> –ü–æ –≤—Å–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            currentResults = allResults;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            displayResults(allResults, originalQuery, getSelectedEngines());
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            const countEl = document.querySelector('.results-count');
            if (countEl) countEl.textContent = allResults.length + ' —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤';
            
            showToast('–ù–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ' + allResults.length, 'success');
        }
        
        function getSelectedEngines() {
            const checkboxes = document.querySelectorAll('input[name="engines"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }
        
        function updateResultsCount(count) {
            const countEl = document.getElementById('resultsCount');
            if (countEl) {
                countEl.textContent = count;
            }
        }
    </script>
</body>
</html>
